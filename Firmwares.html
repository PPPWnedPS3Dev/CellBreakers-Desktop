<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CellBreakers - Firmwares</title>
  <link rel="icon" href="assets/img/favicon.png" />
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #00111a, #003366);
      min-height: 100vh;
      color: white;
      padding: 20px;
    }
    :root{
      --card: rgba(0, 0, 0, 0.75);
      --accent: #0077ff;
      --panel: rgba(0,0,0,0.35);
      --border: rgba(255,255,255,0.12);
    }
    header{
      text-align: center;
      font-size: 2rem;
      font-weight: 800;
      margin: 10px 0 16px;
      text-shadow: 0 0 10px rgba(0,0,0,0.7);
    }
    .topbar{display:flex; justify-content:center; margin-bottom: 14px;}
    .topbar button{
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 700;
      transition: 0.2s;
    }
    .topbar button:hover{ background:#00aaff; transform: translateY(-1px); }

    .wrap{ max-width: 1200px; margin: 0 auto; }

    .tabs{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px 0 14px;
    }
    .tab{
      border: 1px solid var(--border);
      background: var(--panel);
      color: inherit;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 800;
      backdrop-filter: blur(10px);
      transition: 0.2s;
    }
    .tab.active{
      background: var(--accent);
      color: white;
      border-color: transparent;
    }

    .toolbar{
      display: grid;
      grid-template-columns: 1fr 240px;
      gap: 10px;
      align-items: center;
      margin: 0 auto 10px;
    }
    @media (max-width: 700px){ .toolbar{ grid-template-columns: 1fr; } }
    .toolbar input, .toolbar select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: inherit;
      outline: none;
      backdrop-filter: blur(10px);
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 14px;
      margin-top: 10px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      backdrop-filter: blur(10px);
    }
    .title{ font-weight: 900; font-size: 16px; margin-bottom: 6px; line-height: 1.25; }
    .meta{ font-size: 12px; opacity: 0.85; margin-top: 4px; line-height: 1.35; }
    .buttons{ display:flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    .btn{
      flex: 1;
      min-width: 120px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 800;
      transition: 0.2s;
    }
    .btn:hover{ background:#00aaff; transform: translateY(-1px); }

    .state{ text-align:center; padding: 20px 10px; opacity: 0.85; }
    .note{ text-align:center; font-size: 12px; opacity: 0.8; margin-top: 12px; line-height: 1.4; }
    a{ color:#9fd6ff; }
  </style>
</head>
<body>
  <header>CellBreakers - Firmwares</header>

  <div class="topbar">
    <button type="button" onclick="window.location.href='index.html'">Back to Home</button>
  </div>

  <div class="wrap">
    <div class="tabs">
      <button class="tab active" data-tab="cfw">CFW</button>
      <button class="tab" data-tab="hfw">HFW</button>
      <button class="tab" data-tab="ofw">OFW</button>
    </div>

    <div class="toolbar">
      <input id="search" type="text" placeholder="Search (e.g. Evilnat, 4.88, noBD, DEX)..." />
      <select id="sort">
        <option value="nameAsc">A → Z</option>
        <option value="nameDesc">Z → A</option>
      </select>
    </div>

    <div id="status" class="state">Loading…</div>
    <div class="grid" id="grid" style="display:none;"></div>

    <div class="note">
      CFWs are loaded from public Internet Archive download directories (example: 4.88 folder). [web:244]
    </div>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const statusEl = document.getElementById("status");
    const searchEl = document.getElementById("search");
    const sortEl = document.getElementById("sort");

    let currentTab = "cfw";

    // Add more versions here later (4.90, 4.91, 4.92...) as needed.
    const CFW_DIRS = [
      "https://archive.org/download/ps3-cfws/4.88/",
      "https://archive.org/download/ps3-cfws/4.89/"
    ];

    const STATIC = {
      hfw: [
        { name: "HFW 4.92.1 (Hybrid Firmware)", desc: "PSX-Place official release thread.", url: "https://www.psx-place.com/threads/hfw-4-92-1-hybrid-firmware-official-release.46954/" }
      ],
      ofw: [
        { name: "Official PS3 System Software (OFW)", desc: "Sony official system software page.", url: "https://www.playstation.com/en-us/support/hardware/ps3/system-software/" }
      ]
    };

    let cfwItems = [];

    function safe(s){
      return String(s ?? "").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    }

    function renderCards(items){
      grid.innerHTML = "";

      if (!items.length){
        statusEl.style.display = "block";
        grid.style.display = "none";
        statusEl.textContent = "No results.";
        return;
      }

      statusEl.style.display = "none";
      grid.style.display = "grid";

      for (const it of items){
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="title">${safe(it.name)}</div>
          <div class="meta">${safe(it.desc || "")}</div>
          <div class="buttons">
            <button class="btn" type="button" onclick="window.open('${it.url}', '_blank')">Download</button>
          </div>
        `;
        grid.appendChild(card);
      }
    }

    function applyFilters(){
      const term = searchEl.value.trim().toLowerCase();
      const sort = sortEl.value;

      if (currentTab === "cfw"){
        let list = cfwItems.filter(x => !term || x.name.toLowerCase().includes(term));
        if (sort === "nameAsc") list.sort((a,b) => a.name.localeCompare(b.name));
        if (sort === "nameDesc") list.sort((a,b) => b.name.localeCompare(a.name));
        renderCards(list);
        return;
      }

      const list = (STATIC[currentTab] || []).filter(x =>
        !term || x.name.toLowerCase().includes(term) || (x.desc || "").toLowerCase().includes(term)
      );
      renderCards(list);
    }

    function parseDirectoryLinks(html, baseUrl){
      const doc = new DOMParser().parseFromString(html, "text/html");
      const links = [...doc.querySelectorAll("a[href]")];

      // Directory listings contain relative links; collect .PUP only
      const pups = links
        .map(a => a.getAttribute("href"))
        .filter(h => h && h.toLowerCase().endsWith(".pup"))
        .map(h => {
          // Build absolute URL
          const url = new URL(h, baseUrl).toString();
          const name = decodeURIComponent(h.split("/").pop());
          return { name, url, desc: `Source: ${baseUrl.replace("https://archive.org/download/ps3-cfws/","ps3-cfws/")}` };
        });

      return pups;
    }

    async function loadCfw(){
      statusEl.style.display = "block";
      grid.style.display = "none";
      statusEl.textContent = "Loading CFWs from Internet Archive directories…";

      const all = [];
      for (const dir of CFW_DIRS){
        try{
          const res = await fetch(dir);
          if (!res.ok) continue;
          const html = await res.text();
          all.push(...parseDirectoryLinks(html, dir));
        }catch(_e){
          // ignore one dir failing
        }
      }

      cfwItems = all;
      applyFilters();
    }

    function switchTab(tab){
      currentTab = tab;
      document.querySelectorAll(".tab").forEach(b => b.classList.toggle("active", b.dataset.tab === tab));
      applyFilters();
      if (tab === "cfw" && !cfwItems.length) loadCfw();
    }

    searchEl.addEventListener("input", applyFilters);
    sortEl.addEventListener("change", applyFilters);
    document.querySelectorAll(".tab").forEach(btn => btn.addEventListener("click", () => switchTab(btn.dataset.tab)));

    // start
    loadCfw();
  </script>
</body>
</html>
